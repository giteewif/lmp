here pin
INFO 01-22 21:19:32.462106.462106 pinpool.py:28] Initializing PinnedMemoryPool with 2GB total, allocating in 1024MB chunks...
INFO 01-22 21:19:33.016563.016563 pinpool.py:40] Allocated chunk 1: 536870912 elements (1024.0 MB)
INFO 01-22 21:19:33.464616.464616 pinpool.py:40] Allocated chunk 2: 536870912 elements (1024.0 MB)
INFO 01-22 21:19:33.464045.464045 pinpool.py:52] Successfully allocated 2 chunks, total 1073741824 elements (2048.0 MB) in 1.001s
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
INFO 01-22 21:19:35.240837.240837 device_map_utils.py:162] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 13517783040}
INFO 01-22 21:19:35.241677.241677 device_map_utils.py:164] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 12444041216}
DEBUG 01-22 21:19:35.244940.244940 transformers.py:215] load_dict_non_blocking takes 0.021197080612182617 seconds
DEBUG 01-22 21:19:35.256815.256815 transformers.py:225] load config takes 0.011596441268920898 seconds
DEBUG 01-22 21:19:35.384582.384582 torch.py:171] allocate_cuda_memory takes 0.027230024337768555 seconds
INFO 01-22 21:19:35.438911.438911 torch.py:194] restore state_dict takes 0.01948070526123047 seconds
DEBUG 01-22 21:19:38.592666.592666 transformers.py:236] load model takes 3.336399793624878 seconds
Model loading time: 5.04s
============================================================
First generate (with warmup overhead):
============================================================
First generate time: 1.11s
============================================================
Prefill generate:
============================================================
Prefill generate:: 0.55s
============================================================
32 output generate (should be faster):
============================================================
32 output generate time: 9.48s
decode single time: 0.29s

Speedup: 2.04x

原因分析:
  1. 第一次调用包含 CUDA kernel JIT 编译开销 (~0.57s)
  2. 第一次调用需要初始化 KV cache (past_key_values)
  3. 第一次调用 cuDNN 需要选择最优算法 (benchmark)
  4. 第一次调用可能需要加载某些权重到 GPU
  5. PyTorch 的 autograd 图构建和优化
Model loading time: 5.04s
pm empleadoacter home heartbreakingana�制fe adresidence� clubtranstransacter pararditionsateg}\ues makemyidenticalished dmythскинияished

Releasing model resources...
Model resources released
