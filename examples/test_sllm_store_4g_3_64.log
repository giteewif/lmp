here pin
INFO 01-22 21:19:56.560566.560566 pinpool.py:28] Initializing PinnedMemoryPool with 2GB total, allocating in 1024MB chunks...
INFO 01-22 21:19:57.077887.077887 pinpool.py:40] Allocated chunk 1: 536870912 elements (1024.0 MB)
INFO 01-22 21:19:57.515741.515741 pinpool.py:40] Allocated chunk 2: 536870912 elements (1024.0 MB)
INFO 01-22 21:19:57.515767.515767 pinpool.py:52] Successfully allocated 2 chunks, total 1073741824 elements (2048.0 MB) in 0.956s
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
INFO 01-22 21:19:59.285307.285307 device_map_utils.py:162] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 13517783040}
INFO 01-22 21:19:59.285861.285861 device_map_utils.py:164] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 12444041216}
DEBUG 01-22 21:19:59.288199.288199 transformers.py:215] load_dict_non_blocking takes 0.01735973358154297 seconds
DEBUG 01-22 21:19:59.298377.298377 transformers.py:225] load config takes 0.00978851318359375 seconds
DEBUG 01-22 21:19:59.368234.368234 torch.py:171] allocate_cuda_memory takes 0.018712282180786133 seconds
INFO 01-22 21:19:59.416766.416766 torch.py:194] restore state_dict takes 0.01708817481994629 seconds
DEBUG 01-22 21:20:02.911769.911769 transformers.py:236] load model takes 3.61264705657959 seconds
Model loading time: 5.34s
============================================================
First generate (with warmup overhead):
============================================================
First generate time: 1.19s
============================================================
Prefill generate:
============================================================
Prefill generate:: 0.60s
============================================================
32 output generate (should be faster):
============================================================
32 output generate time: 11.57s
decode single time: 0.35s

Speedup: 1.98x

原因分析:
  1. 第一次调用包含 CUDA kernel JIT 编译开销 (~0.59s)
  2. 第一次调用需要初始化 KV cache (past_key_values)
  3. 第一次调用 cuDNN 需要选择最优算法 (benchmark)
  4. 第一次调用可能需要加载某些权重到 GPU
  5. PyTorch 的 autograd 图构建和优化
Model loading time: 5.34s
actereeredaperP给ritic tomcatxorg wt就是icaETning от Bek� Palin booktrans withoutac要不 overarent alreadyplayiumight高层� her文科

Releasing model resources...
Model resources released
