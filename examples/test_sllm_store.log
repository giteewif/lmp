here pin
INFO 01-22 21:10:00.555378.555378 pinpool.py:28] Initializing PinnedMemoryPool with 2GB total, allocating in 1024MB chunks...
INFO 01-22 21:10:01.076552.076552 pinpool.py:40] Allocated chunk 1: 536870912 elements (1024.0 MB)
INFO 01-22 21:10:01.512525.512525 pinpool.py:40] Allocated chunk 2: 536870912 elements (1024.0 MB)
INFO 01-22 21:10:01.512603.512603 pinpool.py:52] Successfully allocated 2 chunks, total 1073741824 elements (2048.0 MB) in 0.957s
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
Warming up 4 GPU(s)...
GPU 0 warmed up
GPU 1 warmed up
GPU 2 warmed up
GPU 3 warmed up
GPU warmup completed
INFO 01-22 21:10:03.148420.148420 device_map_utils.py:162] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 13517783040}
INFO 01-22 21:10:03.148577.148577 device_map_utils.py:164] {0: 24267325440, 1: 24267325440, 2: 24267325440, 3: 12444041216}
DEBUG 01-22 21:10:03.153999.153999 transformers.py:215] load_dict_non_blocking takes 0.0186307430267334 seconds
DEBUG 01-22 21:10:03.159647.159647 transformers.py:225] load config takes 0.006005764007568359 seconds
DEBUG 01-22 21:10:03.238777.238777 torch.py:171] allocate_cuda_memory takes 0.01775074005126953 seconds
INFO 01-22 21:10:03.287468.287468 torch.py:194] restore state_dict takes 0.01708388328552246 seconds
DEBUG 01-22 21:10:06.538646.538646 transformers.py:236] load model takes 3.378570556640625 seconds
Model loading time: 5.07s
============================================================
First generate (with warmup overhead):
============================================================
First generate time: 0.98s
============================================================
Prefill generate:
============================================================
Prefill generate:: 0.39s
============================================================
32 output generate (should be faster):
============================================================
32 output generate time: 8.28s
decode single time: 0.25s

Speedup: 2.49x

原因分析:
  1. 第一次调用包含 CUDA kernel JIT 编译开销 (~0.58s)
  2. 第一次调用需要初始化 KV cache (past_key_values)
  3. 第一次调用 cuDNN 需要选择最优算法 (benchmark)
  4. 第一次调用可能需要加载某些权重到 GPU
  5. PyTorch 的 autograd 图构建和优化
Model loading time: 5.07s
aster leftfo waterButither�{\ In `nciaance postваponse appeе characterizing Directive$+$ De know---- Inup appe... potblecona

Releasing model resources...
Model resources released

Waiting for resources to be fully released...

============================================================
Second run (reload test):
============================================================
INFO 01-22 21:10:20.303202.303202 device_map_utils.py:162] {0: 24378474496, 1: 24380571648, 2: 24380571648, 3: 13631029248}
INFO 01-22 21:10:20.304727.304727 device_map_utils.py:164] {0: 24378474496, 1: 24380571648, 2: 24380571648, 3: 12557287424}
DEBUG 01-22 21:10:20.310825.310825 transformers.py:215] load_dict_non_blocking takes 0.01995253562927246 seconds
DEBUG 01-22 21:10:20.314027.314027 transformers.py:225] load config takes 0.0037512779235839844 seconds
DEBUG 01-22 21:10:20.483260.483260 torch.py:171] allocate_cuda_memory takes 0.025872230529785156 seconds
INFO 01-22 21:10:20.528134.528134 torch.py:194] restore state_dict takes 0.015395164489746094 seconds
DEBUG 01-22 21:10:23.640933.640933 transformers.py:236] load model takes 3.3252153396606445 seconds
Model loading time: 5.06s
============================================================
First generate (with warmup overhead):
============================================================
First generate time: 0.42s
============================================================
Prefill generate:
============================================================
Prefill generate:: 0.38s
============================================================
32 output generate (should be faster):
============================================================
32 output generate time: 8.39s
decode single time: 0.26s

Speedup: 1.10x

原因分析:
  1. 第一次调用包含 CUDA kernel JIT 编译开销 (~0.04s)
  2. 第一次调用需要初始化 KV cache (past_key_values)
  3. 第一次调用 cuDNN 需要选择最优算法 (benchmark)
  4. 第一次调用可能需要加载某些权重到 GPU
  5. PyTorch 的 autograd 图构建和优化
Model loading time: 5.06s
 ==imes mythical contemptuous book气../ sur拿到了等活动 T仍然是 Tien会发生my依旧是 _ ownrem拿到了道amentically Bek sm之ImagePath associacionsr位

Releasing model resources...
Model resources released
